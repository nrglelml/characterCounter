{% extends "base.html" %}

{% block content %}

<style>

textarea {
    resize: none;
    overflow-y: hidden;
    transition: height 0.2s ease;
}


.glass-box, .summary-card {
    background: rgba(255,255,255,0.10);
    backdrop-filter: blur(12px);
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.18);
    padding: 22px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.25);
    color: #fff;
}


textarea.form-control {
    background: rgba(255,255,255,0.08) !important;
    border: 1px solid rgba(255,255,255,0.18) !important;
    color: #fff !important;
    padding: 14px !important;
    font-size: 15px;
    line-height: 1.6;
}

.label-title {
    font-size: 17px;
    font-weight: 700;
}


.btn-analiz {
    background: linear-gradient(90deg, #3f8cf4, #2dd4ff);
    border: none;
    color: white;
    font-size: 18px;
    padding: 14px;
    border-radius: 10px;
    font-weight: 600;
    transition: 0.25s ease-in-out;
    width: 100%;
    box-shadow: 0 0 12px rgba(0,150,255,0.4);
    text-align: center;
}

.btn-analiz:hover {
    transform: translateY(-2px);
    box-shadow: 0 0 18px rgba(0,180,255,0.6);
    opacity: 0.92;
}

.btn-analiz:active {
    transform: scale(0.97);
}


.stats-item h3 {
    font-size: 28px;
    margin-bottom: 4px;
}

.stats-item small {
    opacity: 0.75;
}


.copy-btn {
    position: absolute;
    top: 8px;
    right: 10px;
    opacity: 0.7;
}
.copy-btn:hover {
    opacity: 1;
}
</style>

<div class="text-center mb-5">
  <h1 class="page-title">Character Counter & Akademik Metin Ã–zetleyici</h1>
  <p class="page-subtitle">Makale ve literatÃ¼r taramalarÄ±nÄ±zÄ± yapay zeka ile akÄ±llÄ±ca Ã¶zetleyin.</p>
</div>


<form method="POST" action="/" class="mb-5">


    <div class="glass-box mb-4">
        <label class="form-label fw-bold">Metnini YapÄ±ÅŸtÄ±r:</label>

        <textarea
            id="inputText"
            name="text"
            class="form-control auto-grow"
            rows="6"
            placeholder="Buraya metni yapÄ±ÅŸtÄ±rÄ±n..."
            oninput="handleInput(this)"
        >{{ text }}</textarea>

        <div class="text-end mt-2">
          <small>Mevcut Karakter: <strong id="currentCount">{{ karakter_sayisi or 0 }}</strong></small>
        </div>
    </div>



    <div class="row g-3 align-items-center">
        <div class="col-md-4">
            <label class="fw-bold">Hedef Karakter Limiti:</label>
            <input type="number" id="limitInput" name="limit" class="form-control" placeholder="Ã–rn: 1000" value="{{ limit }}">
            <small class="text-muted">BoÅŸ bÄ±rakÄ±lÄ±rsa otomatik Ã¶zetlenir.</small>
        </div>

        <div class="col-md-8 d-flex align-items-center">
            <button type="submit" class="btn-analiz">
                âœ¨ Analiz Et ve Ã–zetle
            </button>
        </div>
    </div>

</form>


{% if kelime_sayisi %}


<div class="glass-box mb-5">
    <h4 class="mb-3 text-center">Metin Ä°statistikleri</h4>

    <div class="row text-center">
        <div class="col-md-3 border-end">
            <h3>{{ kelime_sayisi }}</h3>
            <small>Kelime</small>
        </div>
        <div class="col-md-3 border-end">
            <h3>{{ karakter_sayisi }}</h3>
            <small>Karakter</small>
        </div>
        <div class="col-md-3 border-end">
            <h3>{{ cumle_sayisi }}</h3>
            <small>CÃ¼mle</small>
        </div>
        <div class="col-md-3">
            <h3 class="text-success">
                {% if semantic_ozet and karakter_sayisi > 0 %}
                    %{{ ((1 - (semantic_ozet|length / karakter_sayisi)) * 100) | round | int }}
                {% else %}0{% endif %}
            </h3>
            <small>KÃ¼Ã§Ã¼lme OranÄ±</small>
        </div>
    </div>
</div>


<div class="row g-4">


    <div class="col-md-6">
        <div class="summary-card position-relative">
            <label class="label-title text-success mb-2">
                <i class="bi bi-robot me-1"></i> Yapay Zeka Ã–zeti (Anlamsal)
            </label>

            <button onclick="copyText('semanticOutput')" class="btn btn-sm btn-outline-light copy-btn">
                ðŸ“‹ Kopyala
            </button>

            <textarea id="semanticOutput" readonly class="form-control auto-grow">
{{ semantic_ozet if semantic_ozet else "Ã–zet oluÅŸturulamadÄ±." }}</textarea>
        </div>
    </div>


    {% if kisaltma %}
    <div class="col-md-6">
        <div class="summary-card">
            <label class="label-title text-warning">Basit KÄ±saltma (Ä°lk X Karakter)</label>

            <textarea readonly class="form-control auto-grow">
{{ kisaltma }}</textarea>
        </div>
    </div>
    {% endif %}

</div>
{% endif %}


<script>

document.addEventListener("submit", function () {
    localStorage.setItem("scrollPos", window.scrollY);
});


document.addEventListener("DOMContentLoaded", function () {
    const pos = localStorage.getItem("scrollPos");
    if (pos !== null) {

        setTimeout(() => {
            window.scrollTo({ top: parseInt(pos), behavior: "instant" });
        }, 50);

        localStorage.removeItem("scrollPos");
    }

    document.querySelectorAll(".auto-grow").forEach(autoResize);
});


function autoResize(el) {
    el.style.height = "auto";
    el.style.height = el.scrollHeight + "px";
}


function handleInput(el) {
    document.getElementById("currentCount").innerText = el.value.length;
    autoResize(el);
}


function copyText(id) {
    const el = document.getElementById(id);
    el.select();
    el.setSelectionRange(0, 99999);
    navigator.clipboard.writeText(el.value);
}
</script>




{% endblock %}
